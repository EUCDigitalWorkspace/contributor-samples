<!DOCTYPE html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="../../../code-sample.css" rel="stylesheet" />
<title>persona-copy-extras</title>

</head>
<body
><!--
Retrieved from https://code.vmware.com/samples/7380/persona-copy-extras
--><div class="header"
><p><a href="../..">EUC Digital Workspace developer portal</a></p
><p>/ <a href="../">Contributor Code Samples</a> /</p
></div

><h1>persona-copy-extras</h1
><p class="github-download"
    ><a href="https://github.com/chrisdhalstead/persona-copy-extras">Download from GitHub</a>.</p
><div class="section readme"> Copy files and folders from Horizon Persona Manager non-standard folders during Horizon 7 to Horizon 8 migration. <br /> <p>Chris Halstead / Josh Spencer - VMware <br /> This script is provided as-is and there is no support</p> <p>Version 2.0 - July 14 2020</p> <hr /> <h3><a id="user-content-overview" class="anchor external" aria-hidden="true" tabindex="-1" href="https://github.com/chrisdhalstead/persona-copy-extras/raw/master/README.md/#overview" target="_blank" rel="noopener"><span aria-hidden="true" class="octicon octicon-link"></span></a>Overview</h3> <p>This script is used to copy all data contained in a VMware Horizon Persona Management environment that is stored in non-standard folder. The folders managed by VMware Horizon Persona Management are detailed here:</p> <p><a href="https://docs.vmware.com/en/VMware-Horizon-7/7.12/horizon-architecture-planning/GUID-05B1BE12-8DD2-4EAE-A3E2-B52CDB6DFC32.html" rel="noopener" class=" external" target="_blank">https://docs.vmware.com/en/VMware-Horizon-7/7.12/horizon-architecture-planning/GUID-05B1BE12-8DD2-4EAE-A3E2-B52CDB6DFC32.html</a></p> <p>We can copy these standard folders locally using a group policy setting, but any extra folders and files are not copied locally. The local profile will use either an VMware App Volumes Writable Volume or an FSLogix Profile Container. This script will copy any non standard folders/files from the VMware Horizon Persona Management to this local profile location. This will allow migration away from VMware Horizon Persona Management.</p> <h3><a id="user-content-usage" class="anchor external" aria-hidden="true" tabindex="-1" href="https://github.com/chrisdhalstead/persona-copy-extras/raw/master/README.md/#usage" target="_blank" rel="noopener"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h3> <ol> <li> <p>Move the <code>copy-persona-extras.ps1</code> file to the location you want to run the script from. A log file will be created for each user showing what is happening at each logon. Make sure the users have the ability to execute PowerShell scripts - <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7" rel="noopener" class=" external" target="_blank">read more here</a></p> </li> <li> <p>Edit the script to point to the location of the Persona Management share<br /></p> <p><a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/persona-copy-extras/blob/master/Images/configurepm.png" class=" external"><img src="https://github.com/chrisdhalstead/persona-copy-extras/raw/master/Images/configurepm.png" alt="configurepm" style="max-width: 100%;" /></a><br /></p> <p>Example: `$PMpath = <strong>&quot;\\fqdnoffileserver\share&quot;</strong> + $un + &quot;.v6&quot;``</p> </li> <li> <p>If needed you can modify the arraylist in the script to add or remove folders to ignore. The folders in this arraylist will be ignored by the script and not copied from the persona profile<br /> <a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/persona-copy-extras/blob/master/Images/ignored-folders.PNG" class=" external"><img src="https://github.com/chrisdhalstead/persona-copy-extras/raw/master/Images/ignored-folders.PNG" alt="ignored-folders" style="max-width: 100%;" /></a></p> </li> <li> <p>Use Dynamic Environment Manager to execute the script<br /></p> <p><a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/persona-copy-extras/blob/master/Images/dem.png" class=" external"><img src="https://github.com/chrisdhalstead/persona-copy-extras/raw/master/Images/dem.png" alt="dem" style="max-width: 100%;" /></a><br /></p> <p>Example: Command: <code>powershell.exe \\fs1\horizonscripts\copy-persona-extras.ps1</code> Example: Check <code>Run asynchronously</code>- this will make sure the script runs in the background and does not impact the logon process</p> <p>Note: if the script has already run for the user it will not copy any data if the <code>ce-flag.txt</code> file exists on the root of the users Persona Management profile. Simply delete that flag file to allow the script to copy data again.</p> </li> <li> <p>When scripts runs, a folder will be created in the users My Documents folder called <code>&quot;ExtrasFromPersona&quot;</code><br /> <a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/persona-copy-extras/blob/master/Images/ExtrasFolder.PNG" class=" external"><img src="https://github.com/chrisdhalstead/persona-copy-extras/raw/master/Images/ExtrasFolder.PNG" alt="ExtrasFolder" style="max-width: 100%;" /></a></p> </li> <li> <p>When the script executes - all folders and files not in the standard folders managed by Persona Management will be copied to the newly created folder<br /> <a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/persona-copy-extras/blob/master/Images/stdfolders.png" class=" external"><img src="https://github.com/chrisdhalstead/persona-copy-extras/raw/master/Images/stdfolders.png" alt="stdfolders" style="max-width: 100%;" /></a></p> </li> <li> <p>When the script is done - all of the extra files will be located in the new folder<br /> <a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/persona-copy-extras/blob/master/Images/extrasfolderdata.PNG" class=" external"><img src="https://github.com/chrisdhalstead/persona-copy-extras/raw/master/Images/extrasfolderdata.PNG" alt="extrasfolderdata" style="max-width: 100%;" /></a></p> </li> <li> <p>The script will then set a flag file <code>ce-flag.txt</code> - the script will see this flag file and skip subsequent copy actions<br /> <a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/persona-copy-extras/blob/master/Images/flag.PNG" class=" external"><img src="https://github.com/chrisdhalstead/persona-copy-extras/raw/master/Images/flag.PNG" alt="flag" style="max-width: 100%;" /></a></p> </li> <li> <p>A log file will be created in /logs under the location where the script is executed - one log file will be created for each user and the latest data will be at the bottom of the log file<br /> <a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/persona-copy-extras/blob/master/Images/logs.PNG" class=" external"><img src="https://github.com/chrisdhalstead/persona-copy-extras/raw/master/Images/logs.PNG" alt="logs" style="max-width: 100%;" /></a><br /> <a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/persona-copy-extras/blob/master/Images/Log-Copy.png" class=" external"><img src="https://github.com/chrisdhalstead/persona-copy-extras/raw/master/Images/Log-Copy.png" alt="Log-Copy" style="max-width: 100%;" /></a><br /></p> <p><a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/persona-copy-extras/blob/master/Images/Log-Same.png" class=" external"><img src="https://github.com/chrisdhalstead/persona-copy-extras/raw/master/Images/Log-Same.png" alt="Log-Same" style="max-width: 100%;" /></a><br /></p> </li> </ol> </div><div class="sample-information"
><p class="label">Contributor</p><p
    >Chris Halstead</p
><p class="label">Platform</p><p
    >Horizon</p
><p class="label">Language</p><p
    >PowerShell</p
><p class="label">License</p><p
    >MIT</p
><p class="label">Tags</p><p
    >euc | samples | Horizon</p
></div

><div class="footer"
><p>Copyright &copy; End User Computing Digital Workspace</p
></div

></body>