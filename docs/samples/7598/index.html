<!DOCTYPE html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="../../../code-sample.css" rel="stylesheet" />
<title>Manage-Horizon-Sessions-By-User</title>

</head>
<body
><!--
Retrieved from https://code.vmware.com/samples/7598/Manage-Horizon-Sessions-By-User
--><div class="header"
><p><a href="../..">EUC Digital Workspace developer portal</a></p
><p>/ <a href="../">Contributor Code Samples</a> /</p
></div

><h1>Manage-Horizon-Sessions-By-User</h1
><p class="github-download"
    ><a href="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user">Download from GitHub</a>.</p
><div class="section readme"> Manage Horizon Sessions By User <br /> <p>This script will allow you to list and manage the active Horizon sessions for a user</p> <p><em><strong>There is no support for this tool - it is provided as-is</strong></em></p> <p>Please provide any feedback directly to me - my contact information:</p> <p>Chris Halstead - Staff Architect, VMware<br /> Email: <a href="https://raw.githubusercontent.com/chrisdhalstead/manage-horizon-sessions-by-user/master/mailto:chalstead@vmware.com" class=" external" target="_blank" rel="noopener">chalstead@vmware.com</a><br /> Twitter: @chrisdhalstead <br /></p> <p>This script requires Horizon 7 PowerCLI - <a href="https://blogs.vmware.com/euc/2020/01/vmware-horizon-7-powercli.html" rel="noopener" class=" external" target="_blank">https://blogs.vmware.com/euc/2020/01/vmware-horizon-7-powercli.html</a> <br /></p> <p>Updated May 7, 2021<br /></p> <hr /> <h3 id="user-content-script-overview"><a class="heading-link external" href="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/raw/main/README.md/#script-overview" target="_blank" rel="noopener">Script Overview<span aria-hidden="true" class="octicon octicon-link"></span></a></h3> <p>This is a PowerShell script that uses PowerCLI and the View-API to query Horizon sessions. You can search for sessions by user and log them off, disconnect them or send them a message</p> <h3 id="user-content-script-usage"><a class="heading-link external" href="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/raw/main/README.md/#script-usage" target="_blank" rel="noopener">Script Usage<span aria-hidden="true" class="octicon octicon-link"></span></a></h3> <p>Run <code>Manage-Horizon-Sessions-ByUser.ps1</code></p> <p><a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/blob/main/Images/MainMenu.PNG" class=" external"><img src="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/raw/main/Images/MainMenu.PNG" alt="Menu" style="max-width: 100%;" /></a></p> <h4 id="user-content-login-to-horizon-connection-server"><a class="heading-link external" href="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/raw/main/README.md/#login-to-horizon-connection-server" target="_blank" rel="noopener">Login to Horizon Connection Server<span aria-hidden="true" class="octicon octicon-link"></span></a></h4> <p>Choose <strong>1</strong> to Login to a Horizon Connection Server</p> <ul> <li> <p>Enter the FQDN of the server when prompted to &quot;Enter the Horizon Server Name&quot; hit enter</p> </li> <li> <p>Enter the Username of an account with Administrative access to the Horizon Server you are connecting to when prompted to &quot;Enter the Username&quot; hit enter</p> </li> <li> <p>Enter that users Password and click enter</p> </li> <li> <p>Enter that users Domain and click enter</p> <p>You will see that you are now logged in to Horizon - click enter to go back to the menu</p> <p><a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/blob/main/Images/Login.PNG" class=" external"><img src="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/raw/main/Images/Login.PNG" alt="Login" style="max-width: 100%;" /></a></p> </li> </ul> <h4 id="user-content-return-horizon-sessions-by-username"><a class="heading-link external" href="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/raw/main/README.md/#return-horizon-sessions-by-username" target="_blank" rel="noopener">Return Horizon Sessions By Username<span aria-hidden="true" class="octicon octicon-link"></span></a></h4> <p>Choose <strong>2</strong> to return Horizon Sessions. You will be prompted for the username to search for.</p> <p><a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/blob/main/Images/getsession.PNG" class=" external"><img src="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/raw/main/Images/getsession.PNG" alt="Sessions" style="max-width: 100%;" /></a></p> <p>If you enter an invalid username or the user has no sessions you will be shown that no sessions could be found for that user</p> <p><a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/blob/main/Images/nosession.PNG" class=" external"><img src="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/raw/main/Images/nosession.PNG" alt="Login" style="max-width: 100%;" /></a></p> <p>If there are sessions you will shown the number of sessions also with details.</p> <p><a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/blob/main/Images/sessioninitial.PNG" class=" external"><img src="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/raw/main/Images/sessioninitial.PNG" alt="Login" style="max-width: 100%;" /></a></p> <p>You will now be presented with a menu to manage the sessions you can:</p> <ol> <li>Logoff all sessions for the user</li> <li>Disconnect all sessions for the user</li> <li>Send all of the users sessions a message</li> <li>Exit without making changes</li> </ol> <p>Select a number to proceed with that action.</p> <p><strong>3 - Send a Message to all sessions for user - you will be prompted for what message you would like to send.</strong></p> <p><a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/blob/main/Images/sendmessage.PNG" class=" external"><img src="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/raw/main/Images/sendmessage.PNG" alt="Login" style="max-width: 100%;" /></a></p> <p>When you click enter you message will be sent and output will show which sessionIDs it was sent to</p> <p><a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/blob/main/Images/messagesent.PNG" class=" external"><img src="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/raw/main/Images/messagesent.PNG" alt="Login" style="max-width: 100%;" /></a></p> <p><strong>2 - Disconnect all sessions for user</strong></p> <p>When you select this option, all of the users sessions will be disconnected and you will receive output on which sessionIDs it was applied to</p> <p><a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/blob/main/Images/disconnected.PNG" class=" external"><img src="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/raw/main/Images/disconnected.PNG" alt="Login" style="max-width: 100%;" /></a></p> <p>After we run that action we can look at the sessions again and see they are disconnected.</p> <p><a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/blob/main/Images/isdisconnected.PNG" class=" external"><img src="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/raw/main/Images/isdisconnected.PNG" alt="Login" style="max-width: 100%;" /></a></p> <p><strong>1 - Logoff all sessions for user</strong></p> <p>When you select this option, all of the users sessions will be logged off and you will receive output on which sessionIDs it was applied to</p> <p><a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/blob/main/Images/logoff.PNG" class=" external"><img src="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/raw/main/Images/logoff.PNG" alt="Login" style="max-width: 100%;" /></a></p> <p>If we search again for sessions for this user, you can see that there are none.</p> <p><a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/blob/main/Images/nosessions.PNG" class=" external"><img src="https://github.com/chrisdhalstead/manage-horizon-sessions-by-user/raw/main/Images/nosessions.PNG" alt="Login" style="max-width: 100%;" /></a></p> </div><div class="sample-information"
><p class="label">Contributor</p><p
    >Chris Halstead</p
><p class="label">Platform</p><p
    >Horizon</p
><p class="label">Language</p><p
    >PowerShell</p
><p class="label">License</p><p
    >MIT</p
><p class="label">Tags</p><p
    >Horizon</p
></div

><div class="footer"
><p>Copyright &copy; End User Computing Digital Workspace</p
></div

></body>