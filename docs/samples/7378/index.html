<!DOCTYPE html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="../../../code-sample.css" rel="stylesheet" />
<title>PersonaManagement-to-FSLogixProfileContainer-Migration</title>

</head>
<body
><!--
Retrieved from https://code.vmware.com/samples/7378/PersonaManagement-to-FSLogixProfileContainer-Migration
--><div class="header"
><p><a href="../..">EUC Digital Workspace developer portal</a></p
><p>/ <a href="../">Contributor Code Samples</a> /</p
></div

><h1>PersonaManagement-to-FSLogixProfileContainer-Migration</h1
><p class="github-download"
    ><a href="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration">Download from GitHub</a>.</p
><div class="section readme"> Script to migrate VMware Horizon Persona Management profiles to Microsoft FSLogix Profile Containers. <br /> <h3><a id="user-content-overview" class="anchor external" aria-hidden="true" tabindex="-1" href="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/raw/master/README.md/#overview" target="_blank" rel="noopener"><span aria-hidden="true" class="octicon octicon-link"></span></a>Overview</h3> <p>Script to Create FSLogix Profile Container and Migrate VMware Horizon Persona Manager Profiles automatically.</p> <p>The script will look in the Persona Management share for .V6 profiles which can be migrated, it will then display them into a Grid View item. You can select multiple Persona Management profiles to migrate.</p> <p>Once you have chosen the profiles to migrate, the script will then create a VHD/x in the location you specified with all of the requirements of as FSLogix profile container. The disk will be attached to the local system with a random drive letter (not in use) and required FSLogix folders and a registry entry will be made. The profile from persona will then be copied to the FSLogix Profile Container and the disk will be detached from the local system. The Profile Container is now ready for the user and includes data from the Persona Management profile.</p> <h3><a id="user-content-usage" class="anchor external" aria-hidden="true" tabindex="-1" href="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/raw/master/README.md/#usage" target="_blank" rel="noopener"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h3> <ol> <li> <p>This script needs to be run as an Administrator. Make sure to launch <code>WindowsPowerShell (Admin)</code> <a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/blob/master/Images/PowerShellAdmin.PNG" class=" external"><img src="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/raw/master/Images/PowerShellAdmin.PNG" alt="PowerShellAdmin" style="max-width: 100%;" /></a></p> </li> <li> <p>Run <code>PM-To-FSL-Migration.ps1</code></p> </li> <li> <p>Enter the UNC Path where you want FSLogix Profile Containers Created ex: <code>Example: \\fileserver\share</code> <a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/blob/master/Images/PCPath.PNG" class=" external"><img src="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/raw/master/Images/PCPath.PNG" alt="PCPath" style="max-width: 100%;" /></a></p> </li> <li> <p>Enter the UNC Path to the Persona Management Share <code>Example: \\fileserver\share</code> <a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/blob/master/Images/PMPath.PNG" class=" external"><img src="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/raw/master/Images/PMPath.PNG" alt="PMPath" style="max-width: 100%;" /></a></p> </li> <li> <p>Enter the size of the FSLogix Profile Container to be created in Gigabytes <code>Example: 30</code> <a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/blob/master/Images/VHDSize.PNG" class=" external"><img src="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/raw/master/Images/VHDSize.PNG" alt="VHDSize" style="max-width: 100%;" /></a></p> </li> <li> <p>Enter the disk format - VHD or VHDX <code>Example: VHDX</code> <a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/blob/master/Images/DiskFormat.PNG" class=" external"><img src="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/raw/master/Images/DiskFormat.PNG" alt="DiskFormat" style="max-width: 100%;" /></a></p> </li> <li> <p>Chose one or multiple Persona Management Profiles to migrate and click OK.</p> <p><a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/blob/master/Images/PickPMProfiles.PNG" class=" external"><img src="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/raw/master/Images/PickPMProfiles.PNG" alt="PickPMProfiles" style="max-width: 100%;" /></a></p> <p><em>Note: Profiles will not show if the Persona Management Profile contains the <code>PM2FSLflag.txt</code> file. Delete the flag file to run the import process again.</em></p> </li> <li> <p>The script will run and do the following:</p> <ol> <li>Create VHD(x) in the specified folder</li> <li>Set Permissions on the VHD(x)</li> <li>Attach the VHD(x) to the local system with a random available drive letter</li> <li>Create directory for FSLogix Profile and set permissions</li> <li>Create ProfileData.Reg file in the FSLogix Directory</li> <li>Copy Persona Management Profile data to the FSLogix Profile Directory with robocopy</li> <li>Create flag file <code>PM2FSLflag.txt</code> indicating that this profile has been migrated</li> <li>Remove drive letter and detach VHD</li> <li>Repeat for every selected Persona Management Profiles</li> </ol> </li> </ol> <h3><a id="user-content-logging" class="anchor external" aria-hidden="true" tabindex="-1" href="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/raw/master/README.md/#logging" target="_blank" rel="noopener"><span aria-hidden="true" class="octicon octicon-link"></span></a>Logging</h3> <p>There is a folder <code>\Logs</code> created under the location where the script is executed from</p> <p>In the logs folder the following logs are created:</p> <ul> <li> <code>PMtoFSL#{username who execute script}</code> - shows details on processing each user.</li> <li> <code>robocopy_{user that was migrated}</code> - detailed logging of the robocopy from Persona to FSLogix per user</li> </ul> <p><a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/blob/master/Images/Logs.PNG" class=" external"><img src="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/raw/master/Images/Logs.PNG" alt="Logs" style="max-width: 100%;" /></a></p> <p>Example of Admin Log:</p> <p><a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/raw/master/README.md/Images/admin_log.PNG" class=" external"><img src="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/raw/master/README.md/Images/admin_log.PNG" alt="admin_log" style="max-width: 100%;" /></a></p> <p>Example of Robocopy Log:</p> <p><a target="_blank" rel="noopener" href="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/blob/master/Images/robocopy_log.PNG" class=" external"><img src="https://github.com/chrisdhalstead/PersonaManagement-to-FSLogixProfileContainer-Migration/raw/master/Images/robocopy_log.PNG" alt="robocopy_log" style="max-width: 100%;" /></a></p> </div><div class="sample-information"
><p class="label">Contributor</p><p
    >Chris Halstead</p
><p class="label">Platform</p><p
    >Horizon</p
><p class="label">Language</p><p
    >PowerShell</p
><p class="label">License</p><p
    >MIT</p
><p class="label">Tags</p><p
    >euc | fslogix | Horizon Persona Management | Horizon | samples</p
></div

><div class="footer"
><p>Copyright &copy; End User Computing Digital Workspace</p
></div

></body>